<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Dashboard</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="Admin/vendors/jvectormap/jquery-jvectormap.css">
    <link rel="stylesheet" href="/Admin/assets/vendors/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="/Admin/assets/vendors/owl-carousel-2/owl.carousel.min.css">
    <link rel="stylesheet" href="/Admin/assets/vendors/owl-carousel-2/owl.theme.default.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="/Admin/css/admin.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="assets/images/favicon.png" />
    <style>
       h1 { color: #f8f9fa; text-align: center; margin: 20px 0; font-size: 2.5rem; padding-top: 20px; }
    </style>
  </head>

  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </head>
  
  <body class="bg-dark">
  
    <div class="container-scroller">
      <%- include('./Partials/sideBar'); %>
  
      <div class="container-fluid page-body-wrapper">
        <%- include('./Partials/navBar'); %>
  
        <div class="container mt-4">
          <h1>Sales Report</h1>
  
          <form id="salesReportForm" action="/admin/dashboard" method="GET" class="row g-3 bg-dark text-light p-4 rounded shadow">
            <div class="col-md-4">
                <label for="filter" class="form-label fw-bold">Select Date Range:</label>
                <select name="filter" id="filter" class="form-select">
                    <option value="daily" <%= filter === 'daily' ? 'selected' : '' %>>Daily</option>
                    <option value="weekly" <%= filter === 'weekly' ? 'selected' : '' %>>Weekly</option>
                    <option value="yearly" <%= filter === 'yearly' ? 'selected' : '' %>>Yearly</option>
                    <option value="custom" <%= filter === 'custom' ? 'selected' : '' %>>Custom</option>
                </select>
            </div>
        
            <div class="col-md-3">
                <label for="startDate" class="form-label fw-bold">Start Date:</label>
                <input type="date" name="startDate" id="startDate" class="form-control bg-secondary text-light border-0" value="<%= startDate %>">
            </div>
        
            <div class="col-md-3">
                <label for="endDate" class="form-label fw-bold">End Date:</label>
                <input type="date" name="endDate" id="endDate" class="form-control bg-secondary text-light border-0" value="<%= endDate %>">
            </div>
        
            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-light w-100 fw-bold">Apply Filter</button>
            </div>
        </form>
        
        
        <!-- Sales Report Table -->
        <table class="table table-bordered text-center">
          <thead class="table-dark">
              <tr>
                  <th>Total Sales</th>
                  <th>Total Orders</th>
                  <th>Total Discount</th>
              </tr>
          </thead>
          <tbody>
              <tr>
                  <td id="totalSales" class="fw-bold text-success">₹<%= salesData.totalSales %></td>
                  <td id="totalOrders" class="fw-bold"><%= salesData.totalOrders %></td>
                  <td id="totalDiscount" class="fw-bold text-danger">₹<%= salesData.totalDiscount %></td>
              </tr>
          </tbody>
      </table>
      
        
          <div class="mt-4">
            <a href="/admin/sales-report/download?format=pdf" class="btn btn-danger">Download PDF</a>
            <a href="/admin/sales-report/download?format=excel" class="btn btn-success">Download Excel</a>
          </div>
        </div>
      </div>
    </div>
  
\
<script>
  document.addEventListener("DOMContentLoaded", function () {
      const filterDropdown = document.getElementById("filter");
      const startDateInput = document.getElementById("startDate");
      const endDateInput = document.getElementById("endDate");
      const filterForm = document.querySelector("#salesReportForm");
  
      function toggleDateFields() {
          if (filterDropdown.value === "custom") {
              startDateInput.style.display = "block";
              endDateInput.style.display = "block";
          } else {
              startDateInput.style.display = "none";
              endDateInput.style.display = "none";
          }
      }
  
      filterDropdown.addEventListener("change", toggleDateFields);
      toggleDateFields(); // Ensure correct visibility on page load
  
      // AJAX form submission
      filterForm.addEventListener("submit", function (event) {
          event.preventDefault();
  
          const formData = new FormData(filterForm);
          const queryString = new URLSearchParams(formData).toString();
  
          fetch(`/admin/dashboard?${queryString}`, { method: "GET", headers: { "X-Requested-With": "XMLHttpRequest" } })
              .then(response => response.json())
              .then(data => {
                  document.getElementById("totalSales").innerText = `₹${data.totalSales}`;
                  document.getElementById("totalOrders").innerText = data.totalOrders;
                  document.getElementById("totalDiscount").innerText = `₹${data.totalDiscount}`;
              })
              .catch(error => console.error("Error fetching data:", error));
      });
  });
  </script>
  



  
  </body>
  

</html>